<%
wrap_layout :core do
  html = yield

  content_for(:toc_module, "in-page-navigation")

  content_for :sidebar do
  %>
    <% sitemap.resources.select{ |r| r.path.end_with?('.html')}.sort_by{ |r| [r.data.weight ? 0 : 1,r.data.weight || 0] }.each do |resource| %>
        <% content = resource.render({layout: false}) %>
        <%=
        table_of_contents(
          content,
          url: resource.url,
          max_level: config[:tech_docs][:max_toc_heading_level]
        ) %>
    <% end %>

  <%
  end

  html
end
%>
